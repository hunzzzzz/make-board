<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ê²Œì‹œê¸€ ì¡°íšŒ</title>
    <style>
      /* ì „ì²´ í˜ì´ì§€ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
      body {
        font-family: "Inter", sans-serif;
        background-color: #f3f4f6;
        display: flex;
        justify-content: center;
        padding: 20px;
        box-sizing: border-box;
        min-height: 100vh;
      }

      /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
      .post-container {
        background-color: #fff;
        padding: 40px;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 900px; /* ê²Œì‹œê¸€ ìƒì„¸ ë³´ê¸° ì»¨í…Œì´ë„ˆ ë„ˆë¹„ */
        box-sizing: border-box;
      }

      /* ê²Œì‹œê¸€ ì œëª© */
      .post-title-area {
        border-bottom: 2px solid #eee;
        padding-bottom: 20px;
        margin-bottom: 20px;
      }

      .post-title {
        font-size: 2.2rem;
        font-weight: bold;
        color: #333;
        margin-bottom: 10px;
        word-break: break-word; /* ì œëª©ì´ ê¸¸ ê²½ìš° ì¤„ë°”ê¿ˆ */
      }

      /* ê²Œì‹œê¸€ ì •ë³´ (ì‘ì„±ì, ë‚ ì§œ, ì¡°íšŒìˆ˜ ë“±) */
      .post-info {
        display: flex;
        flex-wrap: wrap; /* ë°˜ì‘í˜•ì„ ìœ„í•´ ì¤„ë°”ê¿ˆ í—ˆìš© */
        justify-content: space-between;
        font-size: 0.95rem;
        color: #777;
        gap: 10px; /* ìš”ì†Œë“¤ ê°„ì˜ ê°„ê²© */
      }

      .post-info span {
        margin-right: 15px;
      }

      .post-info .author {
        font-weight: 500;
        color: #555;
      }

      .post-info .separator::after {
        content: "|";
        margin-left: 15px;
        color: #ccc;
      }

      /* ê²Œì‹œê¸€ ë‚´ìš© */
      .post-content {
        line-height: 1.8;
        font-size: 1.1rem;
        color: #444;
        min-height: 150px; /* ìµœì†Œ ë†’ì´ */
        padding: 20px 0;
        /* border-bottom: 1px solid #eee; */ /* ì´ ë¶€ë¶„ì€ ì œê±°ëœ ìƒíƒœ ìœ ì§€ */
        white-space: pre-wrap; /* ê³µë°±ê³¼ ì¤„ë°”ê¿ˆ ìœ ì§€ */
        word-break: break-word; /* ê¸´ ë‹¨ì–´ë„ ì˜ë¼ ë‹¤ìŒ ì¤„ë¡œ ë„˜ì–´ê°€ë„ë¡ */
      }

      /* ì²¨ë¶€íŒŒì¼ ì„¹ì…˜ */
      .post-files {
        margin-top: 20px;
        padding-top: 15px;
        border-top: 1px solid #eee; /* ì´ ë¶€ë¶„ì€ ë‹¤ì‹œ ì¶”ê°€í•˜ì—¬ ì¢‹ì•„ìš” ì„¹ì…˜ê³¼ ì²¨ë¶€íŒŒì¼ ì„¹ì…˜ ì‚¬ì´ì— êµ¬ë¶„ì„  ì—­í•  */
      }

      .post-files h3 {
        font-size: 1.2rem;
        color: #555;
        margin-bottom: 10px;
      }

      .file-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      /* ê° íŒŒì¼ í•­ëª© (íšŒìƒ‰ ë„¤ëª¨ì¹¸) */
      .file-list li {
        margin-bottom: 10px; /* ê° íŒŒì¼ í•­ëª© ì•„ë˜ì— ê°„ê²© ì¶”ê°€ */
        padding: 10px 15px; /* ë‚´ë¶€ ì—¬ë°± */
        background-color: #f9f9f9; /* ì—°í•œ íšŒìƒ‰ ë°°ê²½ */
        border: 1px solid #e0e0e0; /* ì—°í•œ í…Œë‘ë¦¬ */
        border-radius: 8px; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
        display: flex;
        align-items: center;
        width: 100%; /* ë¶€ëª¨ ë„ˆë¹„ ì „ì²´ ì‚¬ìš© */
        box-sizing: border-box; /* íŒ¨ë”©ê³¼ í…Œë‘ë¦¬ë¥¼ ë„ˆë¹„ì— í¬í•¨ */
      }

      .file-list li:last-child {
        margin-bottom: 0; /* ë§ˆì§€ë§‰ í•­ëª© ì•„ë˜ ê°„ê²© ì œê±° */
      }

      .file-list li:hover {
        background-color: #f0f0f0; /* í˜¸ë²„ ì‹œ ë°°ê²½ìƒ‰ ë³€ê²½ */
        border-color: #c0c0c0; /* í˜¸ë²„ ì‹œ í…Œë‘ë¦¬ìƒ‰ ë³€ê²½ */
      }

      .file-list a {
        color: #2563eb;
        text-decoration: none;
        font-weight: 500;
        white-space: nowrap; /* íŒŒì¼ ì´ë¦„ì´ í•œ ì¤„ì— í‘œì‹œë˜ë„ë¡ */
        overflow: hidden; /* ë„˜ì¹˜ëŠ” ë¶€ë¶„ ìˆ¨ê¹€ */
        text-overflow: ellipsis; /* ë„˜ì¹˜ëŠ” ë¶€ë¶„ ...ìœ¼ë¡œ í‘œì‹œ */
        margin-right: 5px; /* íŒŒì¼ í¬ê¸° ì •ë³´ì™€ì˜ ê°„ê²© */
      }

      .file-list a:hover {
        text-decoration: underline;
      }

      /* íŒŒì¼ ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
      .file-list .file-icon {
        width: 20px; /* ì•„ì´ì½˜ ë„ˆë¹„ */
        height: 20px; /* ì•„ì´ì½˜ ë†’ì´ */
        vertical-align: middle; /* í…ìŠ¤íŠ¸ì™€ ì„¸ë¡œ ì •ë ¬ */
        margin-right: 8px; /* í…ìŠ¤íŠ¸ì™€ì˜ ê°„ê²© */
        flex-shrink: 0; /* ì•„ì´ì½˜ì´ ì¤„ì–´ë“¤ì§€ ì•Šë„ë¡ */
      }

      /* íŒŒì¼ í¬ê¸° ì •ë³´ */
      .file-list .file-size-info {
        font-size: 0.9em;
        color: #777;
        margin-left: auto; /* íŒŒì¼ ì´ë¦„ê³¼ íŒŒì¼ í¬ê¸° ì •ë³´ë¥¼ ì–‘ ëìœ¼ë¡œ ë³´ë‚´ê¸° ìœ„í•´ */
        flex-shrink: 0; /* í¬ê¸° ì •ë³´ê°€ ì¤„ì–´ë“¤ì§€ ì•Šë„ë¡ */
      }

      /* ì²¨ë¶€íŒŒì¼ ì—†ìŒ ë©”ì‹œì§€ */
      .no-files-message {
        font-size: 1rem;
        color: #888;
        padding: 15px;
        border: 1px dashed #e0e0e0;
        border-radius: 8px;
        background-color: #fcfcfc;
        text-align: center;
      }

      /* ì¢‹ì•„ìš” ë²„íŠ¼ ì„¹ì…˜ */
      .like-section {
        display: flex;
        justify-content: center; /* ì¤‘ì•™ ì •ë ¬ */
        align-items: center;
        margin: 30px 0; /* ìƒí•˜ ì—¬ë°± */
        padding: 20px 0;
        border-top: 1px solid #eee; /* ì´ ë¶€ë¶„ì„ ìœ ì§€í•˜ì—¬ contentì™€ ì¢‹ì•„ìš” ì„¹ì…˜ ì‚¬ì´ì— êµ¬ë¶„ì„  */
        /* border-bottom: 1px solid #eee; */ /* ì´ ë¶€ë¶„ì„ ì œê±° ë˜ëŠ” ì£¼ì„ ì²˜ë¦¬ */
      }

      .like-button {
        background-color: #e0f2fe; /* ì—°í•œ íŒŒë€ìƒ‰ ë°°ê²½ */
        color: #3b82f6; /* íŒŒë€ìƒ‰ í…ìŠ¤íŠ¸ */
        border: 1px solid #93c5fd;
        border-radius: 9999px; /* ë™ê·¸ë€ ë²„íŠ¼ */
        padding: 12px 25px;
        font-size: 1.1rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px; /* ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸ ì‚¬ì´ ê°„ê²© */
        cursor: pointer;
        transition: background-color 0.2s ease, transform 0.2s ease,
          box-shadow 0.2s ease;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .like-button:hover {
        background-color: #dbeafe; /* í˜¸ë²„ ì‹œ ë” ì—°í•œ íŒŒë€ìƒ‰ */
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      }

      .like-button img {
        width: 24px;
        height: 24px;
      }

      .like-count {
        font-size: 1.2rem;
        font-weight: bold;
        margin-left: 5px; /* ë²„íŠ¼ê³¼ì˜ ê°„ê²© */
        color: #333;
      }

      /* ë²„íŠ¼ ê·¸ë£¹ */
      .post-actions {
        display: flex;
        justify-content: flex-end; /* ì˜¤ë¥¸ìª½ ì •ë ¬ */
        gap: 10px;
        margin-top: 30px;
      }

      .action-button {
        padding: 10px 20px;
        background-color: #4f46e5;
        color: #fff;
        font-weight: 600;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        text-decoration: none; /* a íƒœê·¸ ìŠ¤íƒ€ì¼ ì œê±° */
        display: inline-block; /* íŒ¨ë”© ì ìš©ì„ ìœ„í•´ */
        font-size: 1rem; /* ëª¨ë“  ë²„íŠ¼ì˜ ê¸€ì”¨ í¬ê¸°ë¥¼ 1remìœ¼ë¡œ í†µì¼ */
      }

      .action-button:hover {
        background-color: #4338ca;
      }

      /* ì‚­ì œ, ìˆ˜ì • ë²„íŠ¼ ìƒ‰ìƒ */
      .delete-button {
        background-color: #dc2626; /* ë¹¨ê°„ìƒ‰ ê³„ì—´ */
      }

      .delete-button:hover {
        background-color: #b91c1c;
      }

      .edit-button {
        background-color: #f59e0b; /* ì£¼í™©ìƒ‰ ê³„ì—´ */
      }

      .edit-button:hover {
        background-color: #d97706;
      }

      .list-button {
        background-color: #6b7280; /* íšŒìƒ‰ ê³„ì—´ */
      }

      .list-button:hover {
        background-color: #4b5563;
      }

      /* ê²Œì‹œê¸€ì´ ì‚­ì œëœ ê²½ìš° */
      .deleted-message {
        text-align: center;
        font-size: 1.5rem;
        color: #888;
        padding: 50px 0;
        margin-bottom: 20px;
        border: 1px dashed #ccc;
        border-radius: 8px;
        background-color: #f9f9f9;
        text-align: center;
      }

      /* ëŒ“ê¸€ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
      .comments-section {
        margin-top: 40px;
        padding-top: 30px;
        border-top: 1px solid #eee;
      }

      .comments-section h2 {
        font-size: 1.8rem;
        color: #333;
        margin-bottom: 25px;
        text-align: center;
      }

      /* ëŒ“ê¸€ ëª©ë¡ */
      .comment-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .comment-item {
        background-color: #fefefe;
        border: 1px solid #e9e9e9;
        border-radius: 8px;
        padding: 15px 20px;
        margin-bottom: 15px;
      }

      .comment-item:last-child {
        margin-bottom: 0;
      }

      .comment-author {
        font-weight: 600;
        color: #555;
        margin-bottom: 5px;
      }

      .comment-content {
        font-size: 1rem;
        color: #444;
        line-height: 1.6;
        word-break: break-word;
        margin-bottom: 10px;
      }

      .comment-meta {
        font-size: 0.85rem;
        color: #888;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .comment-actions button {
        background: none;
        border: none;
        color: #6366f1; /* íŒŒë€ìƒ‰ ê³„ì—´ */
        cursor: pointer;
        font-size: 0.85rem;
        margin-left: 10px;
        padding: 3px 5px;
        border-radius: 4px;
        transition: background-color 0.2s ease;
      }

      .comment-actions button:hover {
        background-color: #eff6ff; /* ì—°í•œ íŒŒë€ìƒ‰ ë°°ê²½ */
        text-decoration: underline;
      }

      .comment-actions .delete-comment-button {
        color: #ef4444; /* ë¹¨ê°„ìƒ‰ ê³„ì—´ */
      }

      .comment-actions .delete-comment-button:hover {
        background-color: #fee2e2;
      }

      .no-comments-message {
        text-align: center;
        font-size: 1rem;
        color: #888;
        padding: 30px;
        border: 1px dashed #e0e0e0;
        border-radius: 8px;
        background-color: #fcfcfc;
      }

      /* ëŒ“ê¸€ ì‘ì„± í¼ */
      .comment-form {
        margin-top: 30px;
        padding: 20px;
        background-color: #f9f9f9;
        border: 1px solid #e0e0e0;
        border-radius: 10px;
      }

      .comment-form textarea {
        width: calc(100% - 20px);
        min-height: 80px;
        padding: 10px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 1rem;
        resize: vertical;
      }

      .comment-form button {
        padding: 10px 20px;
        background-color: #22c55e; /* ë…¹ìƒ‰ ê³„ì—´ */
        color: #fff;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.3s ease;
        float: right; /* ë²„íŠ¼ì„ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì •ë ¬ */
      }

      .comment-form button:hover {
        background-color: #16a34a;
      }

      .comment-form::after {
        content: "";
        display: block;
        clear: both; /* float í•´ì œ */
      }
    </style>
    <link rel="stylesheet" href="/css/navbar.css" />
    <link rel="icon" href="/icons/favicon.ico" type="image/x-icon" />
  </head>
  <body>
    <div id="app" class="post-container">
      <navbar-component></navbar-component>

      <template v-if="post">
        <div class="post-title-area">
          <h1 class="post-title">{{ post.title }}</h1>
          <div class="post-info">
            <div>
              <span class="author">{{ post.author }}</span>
              <span class="separator"></span>
              <span>ì‘ì„±ì¼: {{ post.formattedCreatedAt }}</span>
              <template v-if="post.isUpdated">
                <span class="separator"></span>
                <span>(ìˆ˜ì •ì¼: {{ post.formattedUpdatedAt }})</span>
              </template>
            </div>
            <div>
              <span>ì¡°íšŒìˆ˜: {{ post.viewCount }}</span>
              <span class="separator"></span>
              <span>ì¶”ì²œìˆ˜: {{ post.likeCount }}</span>
            </div>
          </div>
        </div>

        <div class="post-content">{{ post.content }}</div>

        <div class="like-section">
          <button type="button" class="like-button" @click="toggleLike">
            <img :src="getLikeIconSrc()" alt="ì¢‹ì•„ìš”" />
            <span>ì¢‹ì•„ìš”</span>
            <span class="like-count">{{ post.likeCount }}</span>
          </button>
        </div>

        <div class="post-files">
          <h3>ì²¨ë¶€íŒŒì¼</h3>
          <template v-if="post.files && post.files.length > 0">
            <ul class="file-list">
              <li v-for="file in post.files" :key="file.fileId">
                <img
                  :src="getFileIconSrc(file.fileType)"
                  :alt="file.originalFileName"
                  class="file-icon"
                />
                <a
                  :href="getFileDownloadUrl(file.fileId)"
                  :download="file.originalFileName"
                  >{{ file.originalFileName }}</a
                >
                <span class="file-size-info"
                  >({{ formatFileSize(file.fileSize) }})</span
                >
              </li>
            </ul>
          </template>
          <template v-else>
            <p class="no-files-message">ì²¨ë¶€íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
          </template>
        </div>

        <div class="post-actions">
          <button
            type="button"
            class="action-button edit-button"
            @click="editPost(post.postId)"
          >
            ìˆ˜ì •
          </button>
          <button
            type="button"
            class="action-button delete-button"
            @click="deletePost"
          >
            ì‚­ì œ
          </button>
          <a href="/posts" class="action-button list-button">ëª©ë¡ìœ¼ë¡œ</a>
        </div>

        <div class="comments-section">
          <h2>ëŒ“ê¸€</h2>

          <ul class="comment-list">
            <template v-if="comments.length > 0">
              <li
                v-for="comment in comments"
                :key="comment.commentId"
                class="comment-item"
              >
                <div class="comment-author">{{ comment.author }}</div>
                <div class="comment-content">{{ comment.content }}</div>
                <div class="comment-meta">
                  <span>{{ comment.formattedCreatedAt }}</span>
                  <div class="comment-actions">
                    <button
                      type="button"
                      class="delete-comment-button"
                      @click="deleteComment(comment.commentId)"
                    >
                      ì‚­ì œ
                    </button>
                  </div>
                </div>
              </li>
            </template>
            <template v-else>
              <p class="no-comments-message">
                ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ëŒ“ê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!
              </p>
            </template>
          </ul>

          <div class="comment-form">
            <h3>ëŒ“ê¸€ ì‘ì„±</h3>
            <textarea
              v-model="newCommentContent"
              placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..."
            ></textarea>
            <button type="button" @click="addComment">ë“±ë¡</button>
          </div>
        </div>
      </template>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script type="module">
      import Navbar from "/components/Navbar.js";

      const { createApp, ref, onMounted } = Vue;

      createApp({
        components: {
          "navbar-component": Navbar,
        },

        setup() {
          // ***** [ ë³€ìˆ˜ ì„¸íŒ… ] *****
          const post = ref(null);
          const postId = window.location.pathname.split("/").pop(); // URIì—ì„œ postId ì¶”ì¶œ
          const hasLike = ref(false);
          const comments = ref([]); // ğŸš¨ ëŒ“ê¸€ ëª©ë¡ì„ ì €ì¥í•  ë³€ìˆ˜
          const newCommentContent = ref(""); // ğŸš¨ ìƒˆ ëŒ“ê¸€ ë‚´ìš©ì„ ì €ì¥í•  ë³€ìˆ˜

          const accessToken = localStorage.getItem("accessToken");
          // const loggedInUserId = localStorage.getItem("userId"); // ğŸš¨ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ID ê°€ì ¸ì˜¤ê¸° - isAuthor ì œê±°ë¡œ í•„ìš” ì—†ìŒ

          // ***** [ ê²Œì‹œê¸€ ë¶ˆëŸ¬ì˜¤ê¸° ] *****
          const fetchPost = async () => {
            try {
              const response = await fetch(`/api/posts/${postId}`);
              const data = await response.json();

              // ì„±ê³µ
              if (response.ok) {
                post.value = data;
              } else if (response.status === 403 || response.status === 404) {
                // ì‚¬ìš©ìê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²Œì‹œê¸€ì´ë‚˜ ì‚­ì œëœ ê²Œì‹œê¸€ì— ì ‘ê·¼í•˜ëŠ” ê²½ìš°
                const params = new URLSearchParams({
                  code: data.statusCode || response.status,
                  title: data.errorPageTitle || "ì˜¤ë¥˜ ë°œìƒ",
                  message: data.message || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
                });

                window.location.href = `/error-page?${params.toString()}`; // ì—ëŸ¬ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
              } else {
                console.error("ê²Œì‹œê¸€ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤");
                post.value = null;
              }
            } catch (error) {
              console.error("ê²Œì‹œê¸€ ì¡°íšŒ ì¤‘ ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ ë°œìƒ:", error);
              post.value = null;
            }
          };

          // ***** [ í•´ë‹¹ ê²Œì‹œê¸€ì— ì¢‹ì•„ìš”ë¥¼ ëˆŒë €ëŠ”ì§€ í™•ì¸ ] *****
          const checkLike = async () => {
            try {
              // API í˜¸ì¶œ (/api/posts/{postId}/like/check)
              const response = await fetch(`/api/posts/${postId}/like/check`);
              const isLiked = await response.json();

              if (response.ok) {
                hasLike.value = isLiked;
              } else {
                console.error("ì¢‹ì•„ìš” ìƒíƒœ í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ");
                hasLike.value = false;
              }
            } catch (error) {
              console.error("ì¢‹ì•„ìš” ìƒíƒœ í™•ì¸ ì¤‘ ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ ë°œìƒ:", error);
              hasLike.value = false;
            }
          };

          // ***** [ ëŒ“ê¸€ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ] ğŸš¨ ìƒˆë¡œ ì¶”ê°€ ğŸš¨ *****
          const fetchComments = async () => {
            try {
              const response = await fetch(`/api/posts/${postId}/comments`);
              const data = await response.json(); // ëŒ“ê¸€ ëª©ë¡ (ë°°ì—´ í˜•íƒœ)

              if (response.ok) {
                // ê° ëŒ“ê¸€ì— isAuthor í”Œë˜ê·¸ ì¶”ê°€ (í”„ë¡ íŠ¸ì—”ë“œì—ì„œ í˜„ì¬ ìœ ì €ì™€ ëŒ“ê¸€ ì‘ì„±ì ì¼ì¹˜ ì—¬ë¶€ í™•ì¸)
                comments.value = data.map((comment) => ({
                  ...comment,
                  // isAuthor ê´€ë ¨ ì½”ë“œ ì œê±°
                  // isAuthor: String(comment.userId) === String(loggedInUserId)
                }));
              } else {
                console.error("ëŒ“ê¸€ ëª©ë¡ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ ë°œìƒ");
                comments.value = [];
              }
            } catch (error) {
              console.error("ëŒ“ê¸€ ëª©ë¡ ì¡°íšŒ ì¤‘ ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ ë°œìƒ:", error);
              comments.value = [];
            }
          };

          // ***** [ ë§ˆìš´íŠ¸ ì‹œ ê²Œì‹œê¸€ ì¡°íšŒ, ì¢‹ì•„ìš” ìƒíƒœ, ëŒ“ê¸€ ëª©ë¡ í™•ì¸ ] *****
          onMounted(() => {
            fetchPost();
            checkLike();
            fetchComments(); // ğŸš¨ ëŒ“ê¸€ ëª©ë¡ë„ í•¨ê»˜ ë¶ˆëŸ¬ì˜¤ê¸°
          });

          // ***** [ ì²¨ë¶€íŒŒì¼ ë‹¤ìš´ë¡œë“œ URL ìƒì„± ] *****
          const getFileDownloadUrl = (fileId) => {
            return `/api/files/${fileId}`;
          };

          // ***** [ íŒŒì¼ ì‚¬ì´ì¦ˆ í¬ë§¤íŒ… ] *****
          const formatFileSize = (bytes) => {
            if (bytes === 0) return "0 Bytes";

            const k = 1024;
            const sizes = ["Bytes", "KB", "MB", "GB", "TB"];
            const i = Math.floor(Math.log(bytes) / Math.log(k));

            return (
              parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i]
            );
          };

          // ***** [ íŒŒì¼ ì¢…ë¥˜ì— ë”°ë¥¸ ì•„ì´ì½˜ ê²½ë¡œ ë°˜í™˜ ] *****
          const getFileIconSrc = (fileType) => {
            if (fileType.startsWith("image/")) {
              return "/icons/image.svg";
            } else if (fileType === "application/pdf") {
              return "/icons/pdf.svg";
            } else if (
              fileType.includes("wordprocess") ||
              fileType.includes("officedocument.wordprocessingml")
            ) {
              return "/icons/word.svg";
            } else if (
              fileType.includes("excel") ||
              fileType.includes("spreadsheet") ||
              fileType.includes("officedocument.spreadsheetml")
            ) {
              return "/icons/excel.svg";
            } else if (
              fileType.includes("powerpoint") ||
              fileType.includes("presentation") ||
              fileType.includes("officedocument.presentationml")
            ) {
              return "/icons/ppt.svg";
            } else if (
              fileType === "application/zip" ||
              fileType === "application/x-zip-compressed" ||
              fileType === "application/vnd.rar"
            ) {
              return "/icons/zip.svg";
            } else {
              return "/icons/file.svg";
            }
          };

          // ***** [ ì¢‹ì•„ìš” ì—¬ë¶€ì— ë”°ë¥¸ ì•„ì´ì½˜ ê²½ë¡œ ë°˜í™˜ ] *****
          const getLikeIconSrc = () => {
            if (hasLike.value) {
              return "/icons/heart.svg";
            } else {
              return "/icons/empty-heart.svg";
            }
          };

          // ***** [ ì¢‹ì•„ìš” ë²„íŠ¼ì„ í´ë¦­í•œ ê²½ìš° ] *****
          const toggleLike = async () => {
            // í† í°ì´ ì—†ìœ¼ë©´ ë¡œê·¸ì¸ í•„ìš” ì•Œë¦¼ í›„ ì¢…ë£Œ
            if (!accessToken) {
              alert("ë¡œê·¸ì¸ í›„ ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
              return;
            }

            const method = hasLike.value ? "DELETE" : "POST";

            try {
              const response = await fetch(`/api/posts/${postId}/like`, {
                headers: {
                  Authorization: accessToken,
                },
                method: method,
              });
              const result = await response.json();
              console.log(result);

              if (response.ok) {
                hasLike.value = !hasLike.value;
                await fetchPost(); // ì¢‹ì•„ìš” ìˆ˜ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ ê²Œì‹œê¸€ ì •ë³´ë¥¼ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜´
              } else if (
                response.status === 401 &&
                result.errorCode === "EXPIRED_ATK"
              ) {
                alert("ì¸ì¦ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
                localStorage.removeItem("accessToken");

                window.location.href = "/login";
              } else {
                alert("í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
              }
            } catch (error) {
              alert(
                "ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” ì„œë²„ ì‘ë‹µ ì²˜ë¦¬ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
              );
            }
          };

          // ***** [ ìˆ˜ì • ë²„íŠ¼ì„ í´ë¦­í•œ ê²½ìš° ] *****
          const editPost = async (postId) => {
            // í† í°ì´ ì—†ìœ¼ë©´ ë¡œê·¸ì¸ í•„ìš” ì•Œë¦¼ í›„ ì¢…ë£Œ
            if (!accessToken) {
              alert("ê²Œì‹œê¸€ì„ ìˆ˜ì •í•˜ë ¤ë©´ ë¡œê·¸ì¸í•´ì•¼ í•©ë‹ˆë‹¤.");
              window.location.href = "/login";
              return;
            }

            try {
              const response = await fetch(
                `/api/posts/${postId}/author/check`,
                {
                  headers: {
                    Authorization: accessToken,
                  },
                  method: "GET",
                }
              );

              if (response.ok) {
                const result = await response.json();

                console.log(result);

                if (!result) {
                  alert("ë‹¤ë¥¸ ìœ ì €ì˜ ê²Œì‹œê¸€ì„ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                } else {
                  window.location.href = `/posts/${postId}/edit`;
                }
              } else if (
                response.status === 401 &&
                result.errorCode === "EXPIRED_ATK"
              ) {
                alert("ì¸ì¦ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
                localStorage.removeItem("accessToken");
                window.location.href = "/login";
              } else {
                console.log(await response.json());
                alert("í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
              }
            } catch (error) {
              console.error(error);
              alert(
                "ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” ì„œë²„ ì‘ë‹µ ì²˜ë¦¬ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
              );
            }
          };

          // ***** [ ì‚­ì œ ë²„íŠ¼ì„ í´ë¦­í•œ ê²½ìš° ] *****
          const deletePost = async () => {
            if (!accessToken) {
              alert("ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ë ¤ë©´ ë¡œê·¸ì¸í•´ì•¼ í•©ë‹ˆë‹¤.");
              window.location.href = "/login";
              return;
            }

            if (confirm("ì •ë§ë¡œ ì´ ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
              try {
                const response = await fetch(`/api/posts/${postId}`, {
                  headers: {
                    Authorization: accessToken,
                  },
                  method: "DELETE",
                });
                const result = await response.json();

                if (response.ok) {
                  alert("ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                  window.location.href = "/posts";
                } else if (
                  response.status === 401 &&
                  result.errorCode === "EXPIRED_ATK"
                ) {
                  alert("ì¸ì¦ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
                  localStorage.removeItem("accessToken");

                  window.location.href = "/login";
                } else if (
                  response.status === 403 &&
                  result.errorCode === "CANNOT_DELETE_OTHERS_POST"
                ) {
                  alert("ë‹¤ë¥¸ ìœ ì €ì˜ ê²Œì‹œê¸€ì„ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                } else {
                  alert("í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                }
              } catch (error) {
                alert(
                  "ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” ì„œë²„ ì‘ë‹µ ì²˜ë¦¬ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
                );
              }
            }
          };

          // ***** [ ëŒ“ê¸€ ì¶”ê°€ í•¨ìˆ˜ ] ğŸš¨ ìƒˆë¡œ ì¶”ê°€ ğŸš¨ *****
          const addComment = async () => {
            if (!accessToken) {
              alert("ëŒ“ê¸€ì„ ì‘ì„±í•˜ë ¤ë©´ ë¡œê·¸ì¸í•´ì•¼ í•©ë‹ˆë‹¤.");
              window.location.href = "/login";
              return;
            }
            if (newCommentContent.value.trim() === "") {
              alert("ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
              return;
            }

            try {
              const response = await fetch(`/api/posts/${postId}/comments`, {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  Authorization: accessToken,
                },
                body: JSON.stringify({ content: newCommentContent.value }),
              });
              const result = await response.json();

              if (response.ok) {
                alert("ëŒ“ê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.");
                newCommentContent.value = ""; // ëŒ“ê¸€ ì…ë ¥ì°½ ë¹„ìš°ê¸°
                await fetchComments(); // ëŒ“ê¸€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
              } else if (
                response.status === 401 &&
                result.errorCode === "EXPIRED_ATK"
              ) {
                alert("ì¸ì¦ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
                localStorage.removeItem("accessToken");
                window.location.href = "/login";
              } else if (response.status === 403) {
                alert("ëŒ“ê¸€ ì‘ì„± ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
              } else {
                alert(
                  "ëŒ“ê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."
                );
                console.error("ëŒ“ê¸€ ì‘ì„± ì‹¤íŒ¨:", result);
              }
            } catch (error) {
              console.error("ëŒ“ê¸€ ì‘ì„± ì¤‘ ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ ë°œìƒ:", error);
              alert(
                "ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” ì„œë²„ ì‘ë‹µ ì²˜ë¦¬ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
              );
            }
          };

          // ***** [ ëŒ“ê¸€ ì‚­ì œ í•¨ìˆ˜ ] ğŸš¨ ìƒˆë¡œ ì¶”ê°€ ğŸš¨ *****
          const deleteComment = async (commentId) => {
            if (!accessToken) {
              alert("ëŒ“ê¸€ì„ ì‚­ì œí•˜ë ¤ë©´ ë¡œê·¸ì¸í•´ì•¼ í•©ë‹ˆë‹¤.");
              window.location.href = "/login";
              return;
            }
            if (!confirm("ì •ë§ë¡œ ì´ ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
              return;
            }

            try {
              const response = await fetch(`/api/comments/${commentId}`, {
                // ëŒ“ê¸€ ì‚­ì œëŠ” /api/comments/{commentId}ë¡œ ê°€ì •
                method: "DELETE",
                headers: {
                  Authorization: accessToken,
                },
              });
              const result = await response.json();

              if (response.ok) {
                alert("ëŒ“ê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                await fetchComments(); // ëŒ“ê¸€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
              } else if (
                response.status === 401 &&
                result.errorCode === "EXPIRED_ATK"
              ) {
                alert("ì¸ì¦ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
                localStorage.removeItem("accessToken");
                window.location.href = "/login";
              } else if (response.status === 403) {
                alert("ë‹¤ë¥¸ ìœ ì €ì˜ ëŒ“ê¸€ì„ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
              } else if (response.status === 404) {
                alert("ì‚­ì œí•  ëŒ“ê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
              } else {
                alert(
                  "ëŒ“ê¸€ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."
                );
                console.error("ëŒ“ê¸€ ì‚­ì œ ì‹¤íŒ¨:", result);
              }
            } catch (error) {
              console.error("ëŒ“ê¸€ ì‚­ì œ ì¤‘ ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ ë°œìƒ:", error);
              alert(
                "ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” ì„œë²„ ì‘ë‹µ ì²˜ë¦¬ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
              );
            }
          };

          return {
            post,
            comments,
            newCommentContent,
            getFileDownloadUrl,
            formatFileSize,
            getFileIconSrc,
            getLikeIconSrc,
            toggleLike,
            editPost,
            deletePost,
            addComment,
            deleteComment,
          };
        },
      }).mount("#app");
    </script>
  </body>
</html>
